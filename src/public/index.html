<!-- public/index.html -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="نظام استعلام قاعدة المعرفة Bedrock">
  <title>استعلام قاعدة المعرفة Bedrock</title>
  
  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet" />
  
  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>استعلام قاعدة المعرفة Bedrock</h1>
      <p class="subtitle">نظام ذكي للبحث في قاعدة المعرفة باستخدام تقنيات الذكاء الاصطناعي</p>
    </header>

    <main>
      <form id="queryForm" class="query-form">
        <div class="form-group">
          <label for="knowledgeBaseId">معرّف قاعدة المعرفة:</label>
          <input type="text" id="knowledgeBaseId" required 
                 placeholder="أدخل معرّف قاعدة المعرفة" 
                 aria-label="معرّف قاعدة المعرفة">
        </div>

        <div class="form-group">
          <label for="query">الاستعلام:</label>
          <textarea id="query" required 
                    placeholder="اكتب سؤالك هنا..." 
                    aria-label="نص الاستعلام"></textarea>
        </div>

        <div class="form-group">
          <label for="modelId">نموذج اللغة:</label>
          <select id="modelId" class="model-select" aria-label="اختر نموذج اللغة">
            <option value="anthropic.claude-3-haiku-20240307-v1:0">Claude 3 Haiku</option>
            <option value="anthropic.claude-3-sonnet-20240229-v1:0">Claude 3 Sonnet</option>
            <option value="anthropic.claude-3-5-sonnet-20240620-v1:0">Claude 3.5 Sonnet v2</option>
          </select>
        </div>

        <div class="form-group">
          <h3>فلاتر البيانات الوصفية</h3>
          <div class="filters-explanation">
            <p>اختر قيمة أو أكثر لكل فئة. سيتم تطبيق منطق "أو" بين القيم في نفس الفئة، ومنطق "و" بين الفئات المختلفة.</p>
          </div>
          <div id="filtersContainer" class="filters-container">
            <!-- Subject filter -->
            <div class="filter-section">
              <label for="subjectFilter">المادة:</label>
              <select id="subjectFilter" class="filter-select" multiple="multiple" data-key="Subject"
                      aria-label="اختر المادة">
                <!-- Will be populated dynamically -->
              </select>
            </div>

            <!-- Grade filter -->
            <div class="filter-section">
              <label for="gradeFilter">الصف:</label>
              <select id="gradeFilter" class="filter-select" multiple="multiple" data-key="Grade"
                      aria-label="اختر الصف">
                <!-- Will be populated dynamically -->
              </select>
            </div>

            <!-- Unit filter -->
            <div class="filter-section">
              <label for="unitFilter">الوحدة:</label>
              <select id="unitFilter" class="filter-select" multiple="multiple" data-key="Unit"
                      aria-label="اختر الوحدة">
                <!-- Will be populated dynamically -->
              </select>
            </div>
          </div>
          <button type="button" id="clearFilters" class="secondary-button">مسح جميع الفلاتر</button>
        </div>

        <div class="form-actions">
          <button type="submit" id="submitBtn" class="primary-button">
            <span class="button-text">إرسال الاستعلام</span>
            <span class="button-spinner hidden"></span>
          </button>
        </div>
      </form>

      <div id="error" class="error-message hidden" role="alert"></div>

      <div id="appliedFilters" class="applied-filters hidden">
        <h3>الفلاتر المطبقة</h3>
        <div class="filters-list"></div>
      </div>

      <div id="filterStats" class="filter-stats hidden">
        <div class="stats-container"></div>
      </div>

      <div id="results" class="results hidden">
        <div class="results-container">
          <div class="results-column">
            <h2>استجابة النموذج اللغوي</h2>
            <div id="llmResponse" class="llm-response"></div>
          </div>

          <div class="results-column">
            <h2>نتائج قاعدة المعرفة</h2>
            <div id="resultCards" class="result-cards"></div>
          </div>
        </div>
      </div>

      <!-- Debugging sections -->
      <div id="discardReasons" class="debug-section hidden">
        <h3>أسباب رفض النتائج</h3>
        <div class="discard-reasons-list"></div>
      </div>

      <div id="unfilteredResults" class="debug-section hidden">
        <h3>النتائج الأصلية قبل التصفية</h3>
        <div class="unfiltered-results-list"></div>
      </div>
    </main>

    <div id="loading" class="loading-overlay hidden">
      <div class="spinner"></div>
      <p>جاري التحميل...</p>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>